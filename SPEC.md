# Project Overview

これは C++ wasm（emscripten)と Next.js(TypeScript, Tailwind CSS)with SQLite Wasm(Indexed DB) and WebGL で書かれたカメラおよびレーザー光のリアルタイム投影・制御システムです。Web カメラとサーモグラフィカメラを一台づつ、そして一つのマイコンを通してガルバノスキャナとレーザー出力を調整します。

機能要件は具体的に以下です。

# 基本機能（全ページに実装されるべき機能）

## 1. 各デバイスの設定機能

- TypeScript Only
- 画面左上に配置
- 各ページに必要な、マイコンと Web カメラ、サーモグラフィカメラ等のデバイスを一覧から選択します
- 選択した Web カメラ・サーモグラフィカメラの映像は video stream 経由で HTML Canvas にリアルタイムに投影されます。カメラに関してはセレクトボックスと Canvas がセットです。
- マイコンは Web Serial API 経由で一覧取得・選択されます。
- 選択中のカメラの情報は SQLite Wasm でも保存され、リロードしても自動で設定は保持されます。マイコンの方は API の関係でユーザが手動で設定します

## 2. ファイルシステム機能

- TypeScript Only
- 画面左下に配置
- SQLite Wasm で簡易的に実装されます。
- ディレクトリ構造を持ちますが、基本的には S3 のようなパス名=ファイル名形式です。
- 実態は一つのテーブルです。カラムは以下
  - パス付きファイル名
  - ファイルタイプ：RGB 画像 / Grayscale 画像 / Optical Flow / Remap など
  - データ：JavaScript の型付き配列がよく入ります。
- VSCode のようなトグル付きのファイルシステム UI + 2D Canvas を提供します。ユーザがファイルシステム上で選択した画像を、ファイルタイプに応じて 2D Canvas 上で適切に描画します。Mac の Finder のような UX です。
- ファイル名の編集は不可で OK ですが、削除機能は実装してください。
- IndexedDB なので、保存・削除したファイルは全ページで共通です。これが基軸となりユーザは各ページの機能を協調的に使用してその目的を達成します。

# 各ページに実装される機能

各ページの SPEC.md に記載

# 非機能要件

- 各ページは Next.js の SSG により静的 Web サイトとして出力される。SSR は特に行わない
- ファイルシステムや共通コンポーネントなどは src/shared/ ディレクトリに定義して使用する
- PC の Chrome で動けば OK。レスポンシブデザインは考慮しなくて良い
- Wasm 処理は web worker で走らせる。postMessage を wrap して各関数の呼び出しを行う class を書いてそこに wasm と連携する全処理を集約する。
  - メモリ管理には既存の WM 系クラスを使う
- Web serial api を通じた処理は既存の SerialCommunicator クラスを使用する
- 各機能は適度に分割されて実装されること。TypeScript 側、C++側ともにステートレスな実装を行う。状態を持つ class は基本使用してはならず、SQLite 中心の状態管理を心がける。ただし、値オブジェクトとして振る舞うイミュータブルな class は積極的に使用して良い。
